<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>登入、註冊</title>
  <!-- icon -->
  <link rel="icon" href="./img/header/logoicon.ico" />
  <!-- css -->
  <link rel="stylesheet" href="./style/style.css" />
  <link rel="stylesheet" href="./style/login.css" />
  <!-- jquery -->
  <script src="https://code.jquery.com/jquery-3.6.4.js" integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E="
    crossorigin="anonymous"></script>
  <!-- bootstrap5 icon -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css" />
  <!-- css.gg -->
  <link href="https://css.gg/css" rel="stylesheet" />
  <!-- UNPKG -->
  <link href="https://unpkg.com/css.gg/icons/all.css" rel="stylesheet" />
  <!-- JSDelivr -->
  <link href="https://cdn.jsdelivr.net/npm/css.gg/icons/all.css" rel="stylesheet" />

  <style>
    body {
      padding: 0px;
    }
  </style>
</head>

<body>
  <!-- header -->
  <%- include('share/header')%>

    <div class="container">
      <div class="loginleft">
        <div class="btnbox">
          <p class="btnlogin">登入</p>
          <p class="btnsign">註冊</p>
          <div class="btnbg"></div>
        </div>
      </div>

      <div class="rightbox">
        <div class="loginpage" id="loginpage">
          <form id="loginForm">
            <div class="loginPagelogo">
              <img src="./img/login/login_logo.png" alt="" />
            </div>
            <div class="divinput">
              <i class="bi bi-person"></i>
              <input type="text" class="loginu" id="loginUsername" placeholder="UserName" name="UserName"
                title="請檢查帳號大小寫有無出錯" required />
            </div>

            <div class="divinput">
              <div class="lockIcon">
                <i class="gg-lock"></i>
              </div>
              <input id="password1" type="password" class="loginu" name="password" placeholder="Password"
                title="請確認字母大小寫是否正確" required />
              <i id="eyeclose" class="bi-eye-slash"></i>
              <i id="eyeopen" class="bi-eye"></i>
            </div>
            <input type="submit" id="loginbtn" class="logins" value="會員登入" />
            <div class="wrap">
              <a class="btn popup-btn" href="#letmeopen">忘記密碼</a>
            </div>

            <div class="line-with-circle">
              <div class="divhr"></div>
              <div class="circle"></div>
              <div class="divhr"></div>
            </div>
            <div class="logobtn">
              <a href="#">Facebook</a>
              <a href="#">Google+</a>
            </div>
          </form>
        </div>


        <div class="signbox" id="signbox">
          <!-- <form class="loginbox" action="/signin" method="post"> -->
          <form id="signinForm">
            <div class="loginPagelogo">
              <img src="./img/login/login_logo.png" alt="" />
            </div>

            <!-- 註冊內容 -->
            <div class="signindex">
              <!-- 帳號密碼box -->
              <div class="signleftbox">
                <div class="divinput">
                  <i class="bi bi-person"></i>
                  <input type="text" class="loginu" name="username" placeholder="使用者名稱"
                    pattern="^(?=.*[a-zA-Z])(?=.*[0-9])[a-zA-Z0-9]{6,}$" title="請輸入至少6碼以上英文加數字，且不能包含特殊字元" required />
                </div>
                <div class="divinput">
                  <div class="lockIcon">
                    <i class="gg-lock"></i>
                  </div>
                  <input id="password2" type="password" name="password" class="loginu" placeholder="請輸入密碼"
                    pattern="^(?=.*[a-zA-Z])(?=.*[0-9])[a-zA-Z0-9]{6,}$" title="請輸入至少6碼以上英文加數字，且不能包含特殊字元" required />
                  <i id="eyeclose2" class="bi-eye-slash"></i>
                  <i id="eyeopen2" class="bi-eye"></i>
                </div>
                <div class="divinput">
                  <div class="lockIcon">
                    <i class="gg-lock-unlock"></i>
                  </div>
                  <input id="password3" type="password" class="loginu" placeholder="再次輸入密碼"
                    pattern="^(?=.*[a-zA-Z])(?=.*[0-9])[a-zA-Z0-9]{6,}$" title="請確認與原輸入密碼相同" required />
                  <i id="eyeclose3" class="bi-eye-slash"></i>
                  <i id="eyeopen3" class="bi-eye"></i>
                </div>
              </div>
              <!-- 電話信箱box -->
              <div class="signrightbox">
                <div class="divinput">
                  <i class="bi bi-envelope"></i>
                  <input type="email" class="loginu" name="email" placeholder="電子信箱"
                    pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$" title="檢查信箱格式是否出錯" required />
                </div>
                <div class="divinput">
                  <i class="bi bi-telephone"></i>
                  <input type="tel" class="loginu" name="phone" placeholder="電話號碼" pattern="^09\d{2}\d{6}$"
                    title="請輸入09開頭的10碼電話號碼" required />
                </div>
                <div class="divinput">
                  <i class="bi bi-calendar-heart"></i>
                  <input type="date" class="loginu" name="birthday" placeholder="出生日期" required />
                </div>
              </div>
            </div>
            <input type="submit" class="logins" id="signbtn" value="註冊內容" />
            <div class="logobtn">
              <a href="#">Facebook</a>
              <a href="#">Google+</a>
            </div>
            <!-- <input style="display: block;" type="text" name="user_id" value="<%=  userLast.user_id %>"> -->
          </form>
        </div>
      </div>
    </div>
    <!-- 忘記密碼彈跳窗 -->
    <form id="forgetBox">
      <div class="popup-wrap" id="letmeopen">
        <div class="popup-box transform-out">
          <h1>忘記密碼</h1>
          <h3>請先輸入遊玩帳號，點選寄送驗證碼，並至該信箱取得驗證碼，在執行下列操作!</h3>
          <div class="divinput">
            <i class="bi bi-person"></i>
            <input type="text" class="loginu" id="fgUsername" placeholder="請輸入帳號" name="fgUsername" required />
            <span id="Verification_But">寄送驗證碼</span>
          </div>

          <!-- <input type="button" value="寄送驗證碼" id="Verification_But"> -->

          <div class="divinput">
            <i class="gg-lock"></i>
            <input type="number" class="loginu" id="Verification" placeholder="請填寫信箱內的驗證碼" name="fgNewpad" required />
          </div>

          <div class="divinput">
            <i class="gg-lock"></i>
            <input type="text" class="loginu" id="fgNewpad" placeholder="請填寫新密碼" name="fgNewpad"
              pattern="^(?=.*[a-zA-Z])(?=.*[0-9])[a-zA-Z0-9]{6,}$" title="請輸入至少6碼以上英文加數字，且不能包含特殊字元" required />
          </div>
          <div class="divinput">
            <i class="gg-lock"></i>
            <input type="text" class="loginu" id="aginNewpswd" placeholder="再次輸入新密碼" name="aginNewpswd" required />
          </div>

          <input type="submit" class="loginu" id="updatebut" />
          <div class="close-btn">
            <a class=" popup-close" href="#">x</a>
          </div>
        </div>
      </div>
    </form>
    <script src="./app.js"></script>
    <script src="/app/login.js"></script>
    <script>
      $(function () {
        // 寄驗證碼到信箱
        $("#Verification_But").on("click", function () {
          event.preventDefault();
          $.ajax({
            url: "/login/getVerification",
            type: "POST",
            data: {
              username: $("input[name='fgUsername']").val(),
            },
          }).done(function (data) {
            console.log(data)
            // $('#updatePwd').on('click', function () {
            alert(data)
            // })
          })
        })
        // 更改密碼
        $("#forgetBox").on("submit", function () {
          event.preventDefault();
          $.ajax({
            url: "/login/updatePswd",
            type: "POST",
            data: {
              username: $("input[id='fgUsername']").val(),
              verification: $("input[id='Verification']").val(),
              newpswd: $("input[id='fgNewpad']").val(),
              aginNewpswd: $("input[id='aginNewpswd']").val(),
            },
          }).done(function (data) {
            if (data === '變更密碼成功! 請重新登入') {
              alert(data)
              window.location.assign("http://localhost/login");
              // console.log(data)
            } else {
              // console.log(data)
              alert(data)
            }
            // $('#updatePwd').on('click', function () {
            // })
          })
        })


        // 註冊鈕
        $("#signinForm").on("submit", function () {
          // const userId = $("#user_id").val();
          event.preventDefault();

          if ($('#password2').val() === $('#password3').val()) {
            $.ajax({
              url: "/login/signin",
              type: "POST",
              data: {
                user_id: parseInt($("input[name='user_id']").val()) + 1,
                username: $("input[name='username']").val(),
                password: $("input[id='password2']").val(),
                email: $("input[name='email']").val(),
                phone: $("input[name='phone']").val(),
                birthday: $("input[name='birthday']").val()
              },
            }).done(function (data) {
              if (data == "success") {
                alert("註冊成功，請登入");
                location.reload();
                console.log(data)
              } else {
                // data.includes('username')?alert("內容有誤-帳號"):
                // data.includes('email')?   alert("內容有誤-信箱"):alert("內容有誤-其它錯誤")
                if (data.includes('username')) {
                  alert("該帳號已有人使用")
                } else if (data.includes('email')) {
                  alert("該信箱已有人使用")
                } else {
                  alert("請確認表格皆有填寫正確")
                }
                console.log(data)
              }
              // location.reload();
            })
            // console.log(data);

          } else {
            alert("請確認兩次密碼輸入一致");
            // location.reload();
          }
        });
        //登入
        $("#loginForm").on("submit", function () {
          event.preventDefault();
          $.ajax({
            url: "/login/getUsername",
            type: "POST",
            data: {
              username: $("input[id='loginUsername']").val(),
              password: $("input[id='password1']").val()
            },
          }).done(function (data) {
            console.log(data)

            if (data == "success") {
              alert("登入成功");
              window.location.assign("http://localhost/"); //登入成功後，自動導向哪邊
            } else {
              alert("帳號或密碼錯誤");
              // location.reload();
            }
          })
        });
      })

    </script>
</body>

</html>